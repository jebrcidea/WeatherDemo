<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<style>
#overlay{	
	position: fixed;
	top: 0;
	z-index: 100;
	width: 100%;
	height:100%;
	display: none;
	background: rgba(0,0,0,0.6);
}
.cv-spinner {
	height: 100%;
	display: flex;
	justify-content: center;
	align-items: center;  
}
.spinner {
	width: 40px;
	height: 40px;
	border: 4px #ddd solid;
	border-top: 4px #2e93e6 solid;
	border-radius: 50%;
	animation: sp-anime 0.8s infinite linear;
}
@keyframes sp-anime {
	100% { 
		transform: rotate(360deg); 
	}
}
.is-hide{
	display:none;
}
</style>
<div style="background-color:#add8e6">
	<div >Coordinates: <span id="georeference"></span></div>
	<div >Location: <span id="name"></span></div>
	<div >Country: <span id="country"></span></div>
	<div >Feels like: <span id="feels_like"></span></div>
	<div >Humidity: <span id="humidity"></span></div>
	<div >Pressure: <span id="pressure"></span></div>
	<div >Temperature: <span id="temp"></span></div>
	<div >Max temperature: <span id="temp_max"></span></div>
	<div >Min temperature: <span id="temp_min"></span></div>
	<div >Weather description: <span id="weatherDescription"></span></div>
	<div >Weather Icon: <img id="weatherIcon"></span></div>
	<div >Weather API: <span id="weather"></span></div>
	<button id="button" type="button">Update weather</button>
</div>

<div id="overlay">
	<div class="cv-spinner">
		<span class="spinner"></span>
	</div>
</div>


<script>
var x = document.getElementById("georeference");
var finalGPS;

//function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
//}

function showPosition(position) {
  finalGPS = position;
  x.innerHTML = "Latitude: " + position.coords.latitude + 
  "<br>Longitude: " + position.coords.longitude;
  
  var url = "https://api.openweathermap.org/data/2.5/weather?lat="+position.coords.latitude+"&lon="+position.coords.longitude+"&appid=bd04dc3ee7c7b0f24a22199153e40eae";
	console.log(url);
	
	$.ajax({
	  url: url,
	  type: 'GET',
	  //jsonpCallback: "callback",
	  //dataType: "jsonp",
	  success: function(weatherResponse) {
		console.log(weatherResponse);
		var htmlWeather = document.getElementById("weather");
		htmlWeather.innerHTML = JSON.stringify(weatherResponse); 
		//http://openweathermap.org/img/wn/10d@2x.png
		
		var feels_like = document.getElementById("feels_like");
		var humidity = document.getElementById("humidity");
		var pressure = document.getElementById("pressure");
		var temp = document.getElementById("temp");
		var temp_max = document.getElementById("temp_max");
		var temp_min = document.getElementById("temp_min");
		var name = document.getElementById("name");
		var weatherDescription = document.getElementById("weatherDescription");
		var weatherIcon = document.getElementById("weatherIcon");
		var country = document.getElementById("country");
		
		
		feels_like.innerHTML = weatherResponse.main.feels_like-273.15; 
		humidity.innerHTML = weatherResponse.main.humidity; 
		pressure.innerHTML = weatherResponse.main.pressure; 
		temp.innerHTML = weatherResponse.main.temp  -273.15; 
		temp_max.innerHTML = weatherResponse.main.temp_max- 273.15; 
		temp_min.innerHTML = weatherResponse.main.temp_min-273.15; 
		name.innerHTML = weatherResponse.name; 
		weatherDescription.innerHTML = weatherResponse.weather[0].description; 
		weatherIcon.src = "http://openweathermap.org/img/wn/"+weatherResponse.weather[0].icon+".png"; 
		country.innerHTML = weatherResponse.sys.country; 
	  }
	}).done(function() {
			setTimeout(function(){
				$("#overlay").fadeOut(300);
			},500);
		});
}
$(document).ajaxSend(function() {
		$("#overlay").fadeIn(300);ã€€
	});
	
	$('#button').click(function(){
		showPosition(finalGPS);
	});	
</script>
